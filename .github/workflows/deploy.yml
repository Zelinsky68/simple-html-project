name: Deploy to Kubernetes

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: Setup kubectl
      uses: azure/setup-kubectl@v3
    
    - name: Configure kubectl
      run: |
        mkdir -p ~/.kube
        echo "${{ secrets.KUBECONFIG }}" | base64 -d > ~/.kube/config
        kubectl cluster-info
    
    - name: Create Simple App
      run: |
        kubectl create deployment simple-web --image=nginx:alpine --dry-run=client -o yaml | kubectl apply -f -
        kubectl create service clusterip simple-web --tcp=80:80 --dry-run=client -o yaml | kubectl apply -f -
        echo "âœ… App deployed!"
